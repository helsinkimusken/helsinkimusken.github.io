<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xteam - Cross-Team Coordination System</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="css/project-management.css">
</head>
<body>
    <!-- Login Modal -->
    <div id="loginModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="login-container">
                <h2>Xteam Login</h2>
                <p class="login-subtitle">Authorized Access Only</p>

                <!-- Tab Selection -->
                <div class="login-tabs">
                    <button id="emailLoginTab" class="tab-button active" onclick="switchLoginTab('email')">Email Login</button>
                    <button id="wechatLoginTab" class="tab-button" onclick="switchLoginTab('wechat')">WeChat QR Code</button>
                </div>

                <!-- Email Login Form -->
                <div id="emailLoginForm" class="login-form">
                    <div class="input-group">
                        <label for="loginEmail">Email Address</label>
                        <input type="email" id="loginEmail" placeholder="your.email@company.com" autocomplete="email">
                    </div>
                    <div class="input-group">
                        <label for="loginPassword">Password</label>
                        <input type="password" id="loginPassword" placeholder="Enter your password" autocomplete="current-password">
                    </div>
                    <button id="emailLoginButton" class="btn btn-primary full-width">
                        <span class="icon">üîê</span> Sign In
                    </button>
                    <div id="emailLoginError" class="error-message" style="display: none;"></div>
                </div>

                <!-- WeChat QR Code Login -->
                <div id="wechatLoginForm" class="login-form" style="display: none;">
                    <div class="qr-code-container">
                        <div id="wechatQRCode" class="qr-code-placeholder">
                            <div class="qr-loading">
                                <p>Scan with WeChat to login</p>
                                <div id="qrCodeImage" style="margin: 20px auto;"></div>
                                <p class="qr-hint">QR code expires in <span id="qrTimer">3:00</span></p>
                            </div>
                        </div>
                        <button id="refreshQRButton" class="btn btn-secondary full-width" style="margin-top: 15px;">
                            <span class="icon">üîÑ</span> Refresh QR Code
                        </button>
                    </div>
                    <div id="wechatLoginError" class="error-message" style="display: none;"></div>
                </div>

                <div class="login-footer">
                    <p>Access restricted to authorized team members only</p>
                </div>
            </div>
        </div>
    </div>

    <div class="container" id="mainApp" style="display: none;">
        <header>
            <div class="header-content">
                <div>
                    <h1>Xteam Coordination System</h1>
                    <p class="subtitle">Cross-Team Information Sharing & Tracking</p>
                </div>
                <div class="user-info">
                    <span id="userEmail" class="user-email"></span>
                    <button id="logoutButton" class="btn btn-secondary">
                        <span class="icon">üö™</span> Logout
                    </button>
                </div>
            </div>
        </header>

        <main class="dual-panel-layout">
            <!-- LEFT PANEL: Project Management -->
            <div class="panel panel-project">
                <!-- Project Header -->
                <div class="panel-header">
                    <select id="projectSelector" class="project-selector">
                        <option value="">Select a project...</option>
                    </select>
                    <button id="newProjectBtn" class="btn btn-primary btn-sm">
                        <span class="icon">+</span> New Project
                    </button>
                </div>

                <!-- Tab Navigation: Tasks | Materials | Timeline -->
                <div class="tab-navigation">
                    <button class="tab-btn active" data-tab="tasks">
                        <span class="icon">üìã</span> Tasks
                    </button>
                    <button class="tab-btn" data-tab="materials">
                        <span class="icon">üì¶</span> Materials
                    </button>
                    <button class="tab-btn" data-tab="timeline">
                        <span class="icon">üìÖ</span> Timeline
                    </button>
                </div>

                <!-- Tasks Tab -->
                <div id="tasksTab" class="tab-content active">
                    <!-- View Switcher: Kanban | Gantt | List -->
                    <div class="view-switcher">
                        <button class="view-btn active" data-view="kanban" title="Kanban Board">
                            <span class="icon">üéØ</span> Kanban
                        </button>
                        <button class="view-btn" data-view="gantt" title="Gantt Timeline">
                            <span class="icon">üìä</span> Gantt
                        </button>
                        <button class="view-btn" data-view="list" title="List View">
                            <span class="icon">üìù</span> List
                        </button>
                    </div>

                    <!-- New Task Button -->
                    <div class="task-actions">
                        <button id="newTaskBtn" class="btn btn-primary btn-block">
                            <span class="icon">+</span> New Task
                        </button>
                    </div>

                    <!-- View Container (renders current view) -->
                    <div id="taskViewContainer" class="view-container">
                        <div class="empty-state">
                            <p class="icon">üìã</p>
                            <p>Select a project to view tasks</p>
                            <p class="hint">Create a new project or select an existing one from the dropdown above</p>
                        </div>
                    </div>
                </div>

                <!-- Materials Tab -->
                <div id="materialsTab" class="tab-content" style="display: none;">
                    <div class="task-actions">
                        <button id="newMaterialBtn" class="btn btn-primary btn-block">
                            <span class="icon">+</span> Add Material
                        </button>
                    </div>
                    <div id="materialsContainer" class="materials-container">
                        <div class="empty-state">
                            <p class="icon">üì¶</p>
                            <p>No materials yet</p>
                            <p class="hint">Add materials to track suppliers, delivery dates, and quantities</p>
                        </div>
                    </div>
                </div>

                <!-- Timeline Tab -->
                <div id="timelineTab" class="tab-content" style="display: none;">
                    <div id="projectTimeline" class="project-timeline">
                        <div class="empty-state">
                            <p class="icon">üìÖ</p>
                            <p>No timeline data</p>
                            <p class="hint">Add tasks with start and due dates to see the project timeline</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- RIGHT PANEL: Info Sharing (Existing) -->
            <div class="panel panel-info">
                <div class="panel-title">
                    <h2><span class="icon">üì§</span> Info Sharing</h2>
                </div>

                <div class="upload-section">
                <h2>Submit Information</h2>

                <!-- Text Input -->
                <div class="input-group">
                    <label for="textInput">Text Input</label>
                    <textarea id="textInput" placeholder="Enter your text, notes, or comments..."></textarea>
                </div>

                <!-- Barcode/QR Code Scanner -->
                <div class="input-group">
                    <label>Barcode / QR Code</label>
                    <div style="display: flex; gap: 10px; margin-bottom: 10px; flex-wrap: wrap;">
                        <button id="scanButton" class="btn btn-secondary">
                            <span class="icon">üì∑</span> Scan with Camera
                        </button>
                        <button id="uploadCodeButton" class="btn btn-secondary" onclick="document.getElementById('codeImageUpload').click()">
                            <span class="icon">üñºÔ∏è</span> Upload Image
                        </button>
                        <input type="file" id="codeImageUpload" accept="image/*" hidden>
                    </div>
                    <div id="scannerContainer" style="display: none;">
                        <video id="scannerVideo" autoplay playsinline style="width: 100%; max-width: 500px; margin: 0 auto; display: block; border-radius: 8px;"></video>
                        <button id="closeScannerButton" class="btn btn-danger" style="margin-top: 10px;">Close Scanner</button>
                    </div>
                    <input type="text" id="barcodeInput" placeholder="Scanned code will appear here (or type manually)">
                </div>

                <!-- Photo Upload -->
                <div class="input-group">
                    <label for="photoUpload">Upload Photos</label>
                    <div class="file-upload-area" id="photoDropZone">
                        <input type="file" id="photoUpload" accept="image/*" multiple hidden>
                        <p>Drag & drop photos here or click to browse</p>
                        <button type="button" class="btn btn-secondary" onclick="document.getElementById('photoUpload').click()">
                            <span class="icon">üì∏</span> Choose Photos
                        </button>
                    </div>
                    <div id="photoPreview" class="file-preview"></div>
                </div>

                <!-- File Upload -->
                <div class="input-group">
                    <label for="fileUpload">Upload Files</label>
                    <div class="file-upload-area" id="fileDropZone">
                        <input type="file" id="fileUpload" multiple hidden>
                        <p>Drag & drop files here or click to browse</p>
                        <button type="button" class="btn btn-secondary" onclick="document.getElementById('fileUpload').click()">
                            <span class="icon">üìÑ</span> Choose Files
                        </button>
                    </div>
                    <div id="filePreview" class="file-preview"></div>
                </div>

                <!-- Folder Upload -->
                <div class="input-group">
                    <label for="folderUpload">Upload Folder</label>
                    <div class="file-upload-area">
                        <input type="file" id="folderUpload" webkitdirectory directory multiple hidden>
                        <button type="button" class="btn btn-secondary" onclick="document.getElementById('folderUpload').click()">
                            <span class="icon">üìÅ</span> Choose Folder
                        </button>
                    </div>
                    <div id="folderPreview" class="file-preview"></div>
                </div>

                <!-- Archive Upload (ZIP/RAR) -->
                <div class="input-group">
                    <label for="archiveUpload">Upload Archive (ZIP/RAR)</label>
                    <div class="file-upload-area" id="archiveDropZone">
                        <input type="file" id="archiveUpload" accept=".zip,.rar,.7z,.tar,.gz" multiple hidden>
                        <p>Drag & drop archives here or click to browse</p>
                        <button type="button" class="btn btn-secondary" onclick="document.getElementById('archiveUpload').click()">
                            <span class="icon">üóúÔ∏è</span> Choose Archive
                        </button>
                    </div>
                    <div id="archivePreview" class="file-preview"></div>
                </div>

                <!-- Metadata -->
                <div class="input-group">
                    <label for="userName">Your Name</label>
                    <input type="text" id="userName" placeholder="Enter your name">
                </div>

                <div class="input-group">
                    <label for="category">Category</label>
                    <select id="category">
                        <option value="">Select category...</option>
                        <option value="vendor-performance">Vendor Performance</option>
                        <option value="cross-team-issue">Cross-Team Issue</option>
                        <option value="quality-report">Quality Report</option>
                        <option value="delay-report">Delay Report</option>
                        <option value="achievement">Achievement</option>
                        <option value="other">Other</option>
                    </select>
                </div>

                <div class="button-group">
                    <button id="submitButton" class="btn btn-primary">
                        <span class="icon">‚úì</span> Submit Information
                    </button>
                    <button id="clearButton" class="btn btn-secondary">
                        <span class="icon">‚úó</span> Clear Form
                    </button>
                </div>
            </div>

            <div class="data-section">
                <div class="section-header">
                    <h2>Submitted Records</h2>
                    <div class="filter-controls">
                        <select id="filterCategory">
                            <option value="">All Categories</option>
                            <option value="vendor-performance">Vendor Performance</option>
                            <option value="cross-team-issue">Cross-Team Issue</option>
                            <option value="quality-report">Quality Report</option>
                            <option value="delay-report">Delay Report</option>
                            <option value="achievement">Achievement</option>
                            <option value="other">Other</option>
                        </select>
                        <button id="exportButton" class="btn btn-secondary">
                            <span class="icon">üíæ</span> Export Data
                        </button>
                        <button id="clearAllButton" class="btn btn-danger">
                            <span class="icon">üóëÔ∏è</span> Clear All Data
                        </button>
                    </div>
                </div>
                <div id="recordsList" class="records-list"></div>
            </div>
            </div>
            <!-- End of Right Panel -->
        </main>

        <!-- Dashboard Section -->
        <section class="dashboard-section">
            <h2>üìä Dashboard & Analytics</h2>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="totalRecords">0</div>
                    <div class="stat-label">Total Records</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="todayRecords">0</div>
                    <div class="stat-label">Today's Records</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="weekRecords">0</div>
                    <div class="stat-label">This Week</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="activeUsers">0</div>
                    <div class="stat-label">Active Users</div>
                </div>
            </div>

            <div class="charts-grid">
                <div class="chart-card">
                    <h3>Records by Category</h3>
                    <canvas id="categoryChart"></canvas>
                    <div id="categoryLegend" class="chart-legend"></div>
                </div>
                <div class="chart-card">
                    <h3>Records by User</h3>
                    <canvas id="userChart"></canvas>
                    <div id="userLegend" class="chart-legend"></div>
                </div>
                <div class="chart-card full-width">
                    <h3>Records Over Time (Last 7 Days)</h3>
                    <canvas id="timelineChart"></canvas>
                </div>
            </div>
        </section>

        <footer>
            <p>Xteam Coordination System &copy; 2025</p>
        </footer>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

    <!-- Firebase Configuration -->
    <script src="firebase-config-public.js"></script>

    <!-- QR Code Generator (for WeChat login) -->
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>

    <!-- ZXing Barcode Scanner -->
    <script src="https://unpkg.com/@zxing/library@0.20.0/umd/index.min.js"></script>

    <!-- Core Modules -->
    <script src="js/core/database.js"></script>
    <script src="js/core/file-handler.js"></script>
    <script src="js/core/notification.js"></script>

    <!-- Authentication Manager -->
    <script src="auth.js"></script>

    <!-- Project Management Modules -->
    <script src="js/project-management/project-manager.js"></script>
    <script src="js/project-management/task-handler.js"></script>
    <script src="js/project-management/dependency-manager.js"></script>

    <!-- Main Application -->
    <script src="app.js"></script>
</body>
</html>
